***************
*** 66,72 ****
  # Look for some dependencies using CMake scripts
  FIND_PACKAGE ( ZLIB REQUIRED )
  FIND_PACKAGE ( PNG REQUIRED )
- FIND_PACKAGE ( OpenGL REQUIRED )
  FIND_PACKAGE ( SDL REQUIRED )
  
  if( ENABLE_LINK )
--- 71,77 ----
  # Look for some dependencies using CMake scripts
  FIND_PACKAGE ( ZLIB REQUIRED )
  FIND_PACKAGE ( PNG REQUIRED )
+ FIND_PACKAGE ( OpenGL )
  FIND_PACKAGE ( SDL REQUIRED )
  
  if( ENABLE_LINK )
***************
*** 82,88 ****
      ${ZLIB_LIBRARY}
      ${PNG_LIBRARY})
  
- 
  
  # Disable looking for GTK if not going to build the GTK frontend
  # so that pkg-config is not required
--- 87,96 ----
      ${ZLIB_LIBRARY}
      ${PNG_LIBRARY})
  
+ if ( PNACL )
+    # Add core NaCl libraries.
+    SET(VBAMCORE_LIBS ${VBAMCORE_LIBS} ppapi ppapi_cpp nacl_io)
+ endif ( PNACL )
  
  # Disable looking for GTK if not going to build the GTK frontend
  # so that pkg-config is not required
***************
*** 126,133 ****
      SET( SYSCONFDIR "/etc" )
  ENDIF( NOT SYSCONFDIR )
  
  # C defines
- ADD_DEFINITIONS (-DHAVE_NETINET_IN_H -DHAVE_ARPA_INET_H -DHAVE_ZLIB_H -DFINAL_VERSION -DSDL -DUSE_OPENGL -DSYSCONFDIR='"${SYSCONFDIR}"' -DWITH_LIRC='${WITHLIRC}')
  ADD_DEFINITIONS (-DVERSION='"${VERSION}"' -DPKGDATADIR='"${PKGDATADIR}"' -DPACKAGE='')
  
  if( ENABLE_LINK )
--- 134,145 ----
      SET( SYSCONFDIR "/etc" )
  ENDIF( NOT SYSCONFDIR )
  
+ if ( OpenGL_FOUND )
+   set( USE_OPENGL_FLAG "-DUSE_OPENGL " )
+ endif ( OpenGL_FOUND )
+ 
  # C defines
+ ADD_DEFINITIONS (-DHAVE_NETINET_IN_H -DHAVE_ARPA_INET_H -DHAVE_ZLIB_H -DFINAL_VERSION -DSDL ${USE_OPENGL_FLAG} -DSYSCONFDIR='"${SYSCONFDIR}"' -DWITH_LIRC='${WITHLIRC}')
  ADD_DEFINITIONS (-DVERSION='"${VERSION}"' -DPKGDATADIR='"${PKGDATADIR}"' -DPACKAGE='')
  
  if( ENABLE_LINK )
***************
*** 424,431 ****
          vbam
          WIN32
          ${SRC_SDL}
      )
- 
      IF( WIN32 )
          SET( WIN32_LIBRARIES wsock32 )
      ENDIF( WIN32 )
--- 440,447 ----
          vbam
          WIN32
          ${SRC_SDL}
+         ${SRC_PNACL}
      )
      IF( WIN32 )
          SET( WIN32_LIBRARIES wsock32 )
      ENDIF( WIN32 )
***************
*** 441,451 ****
          ${LIRC_CLIENT_LIBRARY}
      )
  
-     INSTALL(PROGRAMS ${CMAKE_CURRENT_BINARY_DIR}/vbam DESTINATION bin)
-     INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/sdl/vbam.cfg-example
-             DESTINATION ${SYSCONFDIR}
-             RENAME vbam.cfg)
-     INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/vba-over.ini DESTINATION ${DATA_INSTALL_DIR})
  ENDIF( ENABLE_SDL )
  
  IF( ENABLE_GTK )
--- 457,472 ----
          ${LIRC_CLIENT_LIBRARY}
      )
  
+     IF ( PNACL )
+         build_to_app( vbam )
+     ELSE ( PNACL )
+         INSTALL(PROGRAMS ${CMAKE_CURRENT_BINARY_DIR}/vbam DESTINATION bin)
+         INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/sdl/vbam.cfg-example
+                 DESTINATION ${SYSCONFDIR}
+                 RENAME vbam.cfg)
+         INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/vba-over.ini DESTINATION
+                 ${DATA_INSTALL_DIR})
+     ENDIF ( PNACL )
  ENDIF( ENABLE_SDL )
  
  IF( ENABLE_GTK )
